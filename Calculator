<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>McGraw Realtors Production Planner</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define Brand Colors using CSS Variables for easy reference */
        :root {
            --mcgraw-primary: #004813;
            --mcgraw-accent: #3d3e3f;
            --mcgraw-primary-light: #f0f8f3; /* Very light tint of green */
            --mcgraw-accent-light: #f6f6f6; /* Very light tint of gray */
        }

        /* Custom font and basic body styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
        }
        
        /* Custom focus state for inputs using the Accent Color */
        input:focus {
            border-color: var(--mcgraw-accent); 
            /* Using a specific hex color for the box-shadow */
            box-shadow: 0 0 0 3px rgba(61, 62, 63, 0.3); 
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }

        // Helper function for exponential backoff retry logic (not strictly needed here, but kept for completeness)
        async function fetchWithRetry(url, options = {}, retries = 3) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return response;
                } catch (error) {
                    if (i === retries - 1) throw error;
                    const delay = Math.pow(2, i) * 1000;
                    console.warn(`Request failed, retrying in ${delay / 1000}s...`);
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        // Function to format a number as currency
        const formatCurrency = (value) => {
            if (isNaN(value) || value < 0) return '$0.00';
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
        };

        // Function to format a number as a percentage
        const formatPercent = (value) => {
             if (isNaN(value)) return '0.00%';
             return (value * 100).toFixed(1) + '%'; // Using 1 decimal for better readability on display
        };

        // Function to format a number as a simple decimal/integer unit count
        const formatUnits = (value) => {
            if (isNaN(value)) return '0.00';
            // Use 2 decimal places for units
            return value.toFixed(2);
        };


        function calculateMetrics() {
            // --- 1. Get Inputs ---
            const annualGoal = parseFloat(document.getElementById('annualGoal').value) || 0;
            const commissionRate = parseFloat(document.getElementById('commissionRate').value) || 0; 
            const avgSalesPrice = parseFloat(document.getElementById('avgSalesPrice').value) || 0;
            
            // Brokerage Inputs
            const agentSplitPercent = parseFloat(document.getElementById('agentSplitPercent').value) || 0;
            const annualFee = parseFloat(document.getElementById('annualFee').value) || 0;

            // --- 2. GCI Production Calculations (B8, B9, B10) ---
            let gciPerUnit = 0;
            let totalUnits = 0;
            let monthlyUnits = 0;

            // B8: Avg GCI Per Unit ($) = Avg Sales Price * Commission %
            gciPerUnit = avgSalesPrice * commissionRate;

            if (gciPerUnit > 0) {
                // B9: Total Units Needed (Annual) = Target GCI / Avg GCI Per Unit
                totalUnits = annualGoal / gciPerUnit;

                // B10: Monthly Units Needed (Average) = Annual Units / 12
                monthlyUnits = totalUnits / 12;
            }

            // --- 3. Net Take-Home Calculations ---
            
            // Net Annual GCI = Annual Goal * Agent Share %
            const netAnnualGCI = annualGoal * agentSplitPercent;
            
            // Net Annual Income = Net Annual GCI - Annual Fee
            const netAnnualIncome = netAnnualGCI - annualFee;
            
            // Net Monthly Income (Average) = Net Annual Income / 12
            const netMonthlyIncome = netAnnualIncome / 12;


            // --- 4. Update Outputs ---
            
            // GCI Outputs
            document.getElementById('gciPerUnit').textContent = formatCurrency(gciPerUnit);
            document.getElementById('totalUnits').textContent = formatUnits(totalUnits);
            document.getElementById('monthlyUnits').textContent = formatUnits(monthlyUnits);

            // Input Display Updates
            document.getElementById('commissionRateDisplay').textContent = formatPercent(commissionRate);
            document.getElementById('agentSplitDisplay').textContent = formatPercent(agentSplitPercent);
            
            // NET TAKE-HOME Outputs
            document.getElementById('netAnnualGCI').textContent = formatCurrency(netAnnualGCI);
            document.getElementById('netAnnualIncome').textContent = formatCurrency(netAnnualIncome);
            document.getElementById('netMonthlyIncome').textContent = formatCurrency(netMonthlyIncome);
        }

        // Run the calculation on page load to initialize outputs and set defaults
        window.onload = () => {
             // Set default values in inputs
            document.getElementById('annualGoal').value = 150000;
            document.getElementById('commissionRate').value = 0.025;
            document.getElementById('avgSalesPrice').value = 400000;
            
            // Set new defaults (70/30 split, $1680 annual fee)
            document.getElementById('agentSplitPercent').value = 0.70;
            document.getElementById('annualFee').value = 1680;
            
            calculateMetrics();
        };

    </script>
</head>
<body class="p-4 md:p-8 min-h-screen flex items-start justify-center">

    <div class="w-full max-w-4xl bg-white shadow-2xl rounded-xl p-6 md:p-10" style="border-top: 8px solid var(--mcgraw-primary);">

        <!-- A1: Title - Branded -->
        <h1 class="text-3xl font-extrabold mb-8 text-center pb-3 flex items-center justify-center" style="color: var(--mcgraw-accent);">
            <!-- Placeholder Icon for Branding - Using Accent Color -->
            <svg class="w-8 h-8 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="color: var(--mcgraw-primary);"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8v4m0 4v4m-6 3h12a2 2 0 002-2V7a2 2 0 00-2-2H6a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
            <span style="color: var(--mcgraw-primary);">McGraw Realtors</span> &bull; Production Planner
        </h1>

        <!-- Annual Goal Input Section - Primary Color Scheme -->
        <section class="mb-8">
            <h2 class="text-xl font-bold mb-4 border-b pb-2" style="color: var(--mcgraw-primary);">1. Sales Inputs (GCI Goal)</h2>

            <!-- Target Annual GCI -->
            <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-3 p-3 rounded-lg" style="background-color: var(--mcgraw-primary-light);">
                <label for="annualGoal" class="text-lg font-medium text-gray-700 w-full md:w-1/2 mb-2 md:mb-0">
                    Target Annual GCI ($):
                </label>
                <div class="w-full md:w-1/2">
                    <input type="number" id="annualGoal" placeholder="e.g., 150000"
                        oninput="calculateMetrics()"
                        class="w-full p-3 border-2 border-green-200 rounded-lg text-lg text-right font-mono focus:outline-none transition duration-150 ease-in-out">
                </div>
            </div>

            <!-- Average Commission % -->
            <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-3 p-3 rounded-lg" style="background-color: var(--mcgraw-primary-light);">
                <label for="commissionRate" class="text-lg font-medium text-gray-700 w-full md:w-1/2 mb-2 md:mb-0">
                    Average Commission % (Decimal):
                    <span id="commissionRateDisplay" class="ml-2 font-mono font-semibold" style="color: var(--mcgraw-primary);">0.0%</span>
                </label>
                <div class="w-full md:w-1/2">
                    <input type="number" id="commissionRate" placeholder="e.g., 0.025" step="0.001"
                        oninput="calculateMetrics()"
                        class="w-full p-3 border-2 border-green-200 rounded-lg text-lg text-right font-mono focus:outline-none transition duration-150 ease-in-out">
                </div>
            </div>

            <!-- Average Sales Price -->
            <div class="flex flex-col md:flex-row items-start md:items-center justify-between p-3 rounded-lg" style="background-color: var(--mcgraw-primary-light);">
                <label for="avgSalesPrice" class="text-lg font-medium text-gray-700 w-full md:w-1/2 mb-2 md:mb-0">
                    Average Sales Price ($):
                </label>
                <div class="w-full md:w-1/2">
                    <input type="number" id="avgSalesPrice" placeholder="e.g., 400000"
                        oninput="calculateMetrics()"
                        class="w-full p-3 border-2 border-green-200 rounded-lg text-lg text-right font-mono focus:outline-none transition duration-150 ease-in-out">
                </div>
            </div>
        </section>
        
        <!-- Brokerage & Fees Section - Accent Color Scheme -->
        <section class="mb-10 mt-8">
            <h2 class="text-xl font-bold mb-4 border-b pb-2" style="color: var(--mcgraw-accent);">2. Cost Inputs (Brokerage & Fees)</h2>

            <!-- Agent Split Percentage -->
            <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-3 p-3 rounded-lg" style="background-color: var(--mcgraw-accent-light);">
                <label for="agentSplitPercent" class="text-lg font-medium text-gray-700 w-full md:w-1/2 mb-2 md:mb-0">
                    Agent Commission Split % (Decimal):
                    <span id="agentSplitDisplay" class="ml-2 font-mono font-semibold" style="color: var(--mcgraw-accent);">0.0%</span>
                </label>
                <div class="w-full md:w-1/2">
                    <input type="number" id="agentSplitPercent" placeholder="e.g., 0.70 (for 70%)" step="0.01"
                        oninput="calculateMetrics()"
                        class="w-full p-3 border-2 border-gray-300 rounded-lg text-lg text-right font-mono focus:outline-none transition duration-150 ease-in-out">
                </div>
            </div>

            <!-- Annual Fee -->
            <div class="flex flex-col md:flex-row items-start md:items-center justify-between p-3 rounded-lg" style="background-color: var(--mcgraw-accent-light);">
                <label for="annualFee" class="text-lg font-medium text-gray-700 w-full md:w-1/2 mb-2 md:mb-0">
                    Fixed Annual Fees ($):
                </label>
                <div class="w-full md:w-1/2">
                    <input type="number" id="annualFee" placeholder="e.g., 1680"
                        oninput="calculateMetrics()"
                        class="w-full p-3 border-2 border-gray-300 rounded-lg text-lg text-right font-mono focus:outline-none transition duration-150 ease-in-out">
                </div>
            </div>
        </section>


        <!-- KEY PRODUCTION METRICS Section (A7:B10) -->
        <section class="mt-8 pt-6 border-t-2 border-gray-200">
            <h2 class="text-2xl font-extrabold" style="color: var(--mcgraw-primary);">PRODUCTION & INCOME RESULTS</h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-6">
                <!-- REQUIRED PRODUCTION METRICS (Left Column) - Green for Success -->
                <div class="bg-gray-50 p-5 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold text-green-700 mb-4 border-b pb-2">Required Production Metrics</h3>

                    <!-- Metric 1: Avg GCI Per Unit -->
                    <div class="flex justify-between items-center mb-4 pb-2">
                        <span class="text-base font-medium text-gray-600">GCI Per Unit ($):</span>
                        <span id="gciPerUnit" class="text-lg font-bold text-green-600 text-right font-mono">
                            $0.00
                        </span>
                    </div>

                    <!-- Metric 2: Total Units Needed (Annual) -->
                    <div class="flex justify-between items-center mb-4 pb-2">
                        <span class="text-base font-medium text-gray-600">Total Units Needed (Annual):</span>
                        <span id="totalUnits" class="text-lg font-bold text-green-600 text-right font-mono">
                            0.00
                        </span>
                    </div>

                    <!-- Metric 3: Monthly Units Needed (Average) -->
                    <div class="flex justify-between items-center p-3 bg-green-100 rounded-lg border-l-4 border-green-500">
                        <span class="text-lg font-extrabold text-gray-700">Monthly Units Needed:</span>
                        <span id="monthlyUnits" class="text-xl font-extrabold text-green-700 text-right font-mono">
                            0.00
                        </span>
                    </div>
                </div>

                <!-- NET TAKE-HOME INCOME (Right Column) - Indigo for Premium/Final Result -->
                <div class="bg-indigo-50 p-5 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold text-indigo-700 mb-4 border-b pb-2">Net Take-Home Income</h3>

                    <!-- Metric 4: Net Annual GCI (After Split) -->
                    <div class="flex justify-between items-center mb-4 pb-2">
                        <span class="text-base font-medium text-gray-600">Net Annual GCI (After Split):</span>
                        <span id="netAnnualGCI" class="text-lg font-bold text-indigo-600 text-right font-mono">
                            $0.00
                        </span>
                    </div>
                    
                    <!-- Metric 5: Net Annual Income (After Fees) -->
                    <div class="flex justify-between items-center mb-4 pb-2">
                        <span class="text-base font-medium text-gray-600">Net Annual Income (After Fees):</span>
                        <span id="netAnnualIncome" class="text-lg font-bold text-indigo-600 text-right font-mono">
                            $0.00
                        </span>
                    </div>

                    <!-- Metric 6: Net Monthly Income (Average) -->
                    <div class="flex justify-between items-center p-3 bg-indigo-100 rounded-lg border-l-4 border-indigo-500">
                        <span class="text-lg font-extrabold text-gray-700">Net Monthly Take-Home:</span>
                        <span id="netMonthlyIncome" class="text-xl font-extrabold text-indigo-700 text-right font-mono">
                            $0.00
                        </span>
                    </div>
                </div>
            </div>
        </section>

    </div>

</body>
</html>
